{% extends "budget/base.html" %}
{% block title %}Manage Family Members{% endblock %}

{% block content %}
<h1>Manage Family Members</h1>

{% if group %}
  <h2>Family Code: {{ group.code }}</h2>

  <h3>Add member by username</h3>
  <form method="post">
    {% csrf_token %}
    <input type="hidden" name="action" value="add">
    <label for="id_username">Username</label>
    <input type="text" name="username" id="id_username">
    <button type="submit">Add Member</button>
  </form>

  <h3>Current Members</h3>
  <table>
    <tr>
      <th>Name</th>
      <th>Role</th>
      <th>Income</th>
      <th>Expenses</th>
      <th>Actions</th>
    </tr>
    {% for member in members %}
      <tr>
        <td>{{ member.display_name }}</td>
        <td>{{ member.role }}</td>
        <td>{{ member.income }}</td>
        <td>{{ member.expenses }}</td>
        <td>
          {% if member.is_owner %}
            Owner
          {% else %}
            {# Promote / demote buttons based on role #}
            {% if member.role == "Member" %}
              <form method="post" style="display:inline">
                {% csrf_token %}
                <input type="hidden" name="action" value="promote">
                <input type="hidden" name="member_profile_id" value="{{ member.profile_id }}">
                <button type="submit">Make Admin</button>
              </form>
            {% elif member.role == "Admin" %}
              <form method="post" style="display:inline">
                {% csrf_token %}
                <input type="hidden" name="action" value="demote">
                <input type="hidden" name="member_profile_id" value="{{ member.profile_id }}">
                <button type="submit">Make Member</button>
              </form>
            {% endif %}

            {# Remove member button #}
            <form method="post" style="display:inline; margin-left: 4px;">
              {% csrf_token %}
              <input type="hidden" name="action" value="remove">
              <input type="hidden" name="member_profile_id" value="{{ member.profile_id }}">
              <button type="submit">Remove</button>
            </form>
          {% endif %}
        </td>
      </tr>
    {% endfor %}
  </table>
{% else %}
  <p>You are not currently in a family group.</p>
{% endif %}
{% endblock %}
