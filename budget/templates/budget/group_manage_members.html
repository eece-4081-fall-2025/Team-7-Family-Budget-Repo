{% extends "budget/base.html" %}

{% block title %}Manage Family Members{% endblock %}

{% block content %}
<h1>Manage Family Members</h1>

{% if group %}
  <p><strong>Group:</strong> {{ group.name }}</p>
{% else %}
  <p>You are not currently in a family group.</p>
  <p><a href="{% url 'group_members' %}">Back to family members</a></p>
  {% endblock %}
  {% return %}
{% endif %}

<p>
  <a href="{% url 'group_members' %}">Back to family members</a>
</p>

<hr>

<h2>Add Member by Username</h2>

{% if error %}
  <p style="color: red;">{{ error }}</p>
{% endif %}

<form method="post">
  {% csrf_token %}
  <input type="hidden" name="action" value="add">
  <label for="username">Username:</label>
  <input type="text" name="username" id="username" required>
  <button type="submit">Add</button>
</form>

<hr>

<h2>Current Members</h2>
<table>
  <thead>
    <tr>
      <th>Name / Nickname</th>
      <th>Username</th>
      <th>Role</th>
      <th>Income</th>
      <th>Expenses</th>
      <th>Actions</th>
    </tr>
  </thead>
  <tbody>
    {% for member in members %}
      <tr>
        <td>{{ member.display_name }}</td>
        <td>{{ member.username }}</td>
        <td>{{ member.role }}</td>
        <td>{{ member.income }}</td>
        <td>{{ member.expenses }}</td>
        <td>
          {% if member.role != "Owner" %}
            <form method="post" action="{% url 'group_manage_members' %}" style="display:inline;">
              {% csrf_token %}
              <input type="hidden" name="action" value="remove">
              <input type="hidden" name="member_profile_id" value="{{ member.profile_id }}">
              <button type="submit">Remove</button>
            </form>
          {% else %}
            (Owner)
          {% endif %}
        </td>
      </tr>
    {% empty %}
      <tr>
        <td colspan="6">No members in this group.</td>
      </tr>
    {% endfor %}
  </tbody>
</table>
{% endblock %}

